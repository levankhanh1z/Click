local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local UserInputService = game:GetService("UserInputService")

local maxClickDistance = 10
local pickaxe = game.Workspace.Debris.Plr.tking12z.Pickaxe  -- Điều chỉnh đường dẫn đến Pickaxe của bạn
local mine = game.Workspace.Mine -- Điều chỉnh đường dẫn đến Mine của bạn

local function isPartNearPlayer(part)
    local playerPosition = Players.LocalPlayer.Character and Players.LocalPlayer.Character:FindFirstChild("HumanoidRootPart") and Players.LocalPlayer.Character.HumanoidRootPart.Position
    if playerPosition then
        local partPosition = part.Position
        local distance = (playerPosition - partPosition).Magnitude
        return distance <= maxClickDistance
    end
    return false
end

local function handleClickAndFireServer(part)
    print("Auto Clicked on", part.Name)

    if isPartNearPlayer(part) then
        local partCFrame = part.CFrame
        local clickPosition = part.Position

        local remoteEventName = "MineEvent"  -- Thay đổi thành tên sự kiện từ xa bạn đang sử dụng

        local pinglessMineEvent = ReplicatedStorage:FindFirstChild("PinglessMine")
        local mineOreEvent = ReplicatedStorage:FindFirstChild("MineOre")
        local mineEvent = part:FindFirstChild(remoteEventName)

        if pinglessMineEvent then
            local args = {partCFrame, clickPosition}
            pinglessMineEvent:FireServer(unpack(args))
        else
            warn("RemoteEvent 'PinglessMine' not found.")
        end

        if mineOreEvent then
            local args = {partCFrame, clickPosition}
            mineOreEvent:FireServer(unpack(args))
        else
            warn("RemoteEvent 'MineOre' not found.")
        end

        if mineEvent then
            local args = {partCFrame, clickPosition}
            mineEvent:FireServer(unpack(args))
        else
            warn("RemoteEvent '" .. remoteEventName .. "' not found.")
        end
    end
end

local function handleTouched(part)
    part.Touched:Connect(function(hit)
        if hit:IsA("Player") then
            print("Player touched", part.Name)
            -- Kiểm tra xem Pickaxe có đang kích hoạt không
            local character = hit.Character
            if character and character:FindFirstChild("Humanoid") then
                local humanoid = character.Humanoid
                if humanoid:FindFirstChild("Tool") then
                    local tool = humanoid.Tool
                    if tool and tool:IsA("Tool") and tool.Name == "Pickaxe" then
                        -- Thực hiện sự kiện click khi Pickaxe chạm vào Part
                        handleClickAndFireServer(part)
                    end
                end
            end
        end
    end)
end

-- Sự kiện Touched để theo dõi khi người chơi chạm vào các Part trong Mine
for _, part in pairs(mine:GetDescendants()) do
    if part:IsA("Part") then
        handleTouched(part)
    end
end
