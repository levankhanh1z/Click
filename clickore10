local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

-- Khoảng cách tối đa để xem xét khi click
local maxClickDistance = 10

-- Function để kiểm tra xem một Part có gần người chơi không
local function isPartNearPlayer(part)
    local playerPosition = Players.LocalPlayer.Character and Players.LocalPlayer.Character:FindFirstChild("HumanoidRootPart") and Players.LocalPlayer.Character.HumanoidRootPart.Position
    if playerPosition then
        local partPosition = part.Position
        local distance = (playerPosition - partPosition).Magnitude
        return distance <= maxClickDistance
    end
    return false
end

-- Function để xử lý sự kiện click và gửi sự kiện từ xa
local function handleClickAndFireServer(part)
    if part.Name == "Stone" then
        print("Clicked on Stone part!")

        -- Kiểm tra xem con trỏ chuột có đang đặt trên Part không
        if isPartNearPlayer(part) then
            local partCFrame = part.CFrame
            local clickPosition = part.Position

            -- Gửi sự kiện từ xa tới server - PinglessMine (ví dụ)
            local pinglessMineEvent = ReplicatedStorage:FindFirstChild("PinglessMine")
            if pinglessMineEvent then
                local args = {partCFrame, clickPosition}
                pinglessMineEvent:FireServer(unpack(args))
            else
                warn("RemoteEvent 'PinglessMine' not found.")
            end

            -- Gửi sự kiện từ xa tới server - MineOre (ví dụ)
            local mineOreEvent = ReplicatedStorage:FindFirstChild("MineOre")
            if mineOreEvent then
                local args = {partCFrame, clickPosition}
                mineOreEvent:FireServer(unpack(args))
            else
                warn("RemoteEvent 'MineOre' not found.")
            end

            -- Gửi sự kiện từ xa tới server - MineEvent (ví dụ)
            local mineEvent = ReplicatedStorage:FindFirstChild("MineEvent")
            if mineEvent then
                local args = {partCFrame, clickPosition}
                mineEvent:FireServer(unpack(args))
            else
                warn("RemoteEvent 'MineEvent' not found.")
            end
        end
    end
end

-- Sự kiện MouseEnter để theo dõi khi con trỏ chuột bắt đầu nhấn vào Part
local function handleMouseEnter(part)
    part.MouseEnter:Connect(function()
        print("Mouse entered", part.Name)
        -- Thực hiện xử lý khi con trỏ chuột bắt đầu nhấn vào Part
        -- (Ví dụ: Gọi handleClickAndFireServer nếu muốn thực hiện sự kiện click)
        handleClickAndFireServer(part)
    end)
end

-- Sự kiện MouseLeave để theo dõi khi con trỏ chuột rời khỏi Part
local function handleMouseLeave(part)
    part.MouseLeave:Connect(function()
        print("Mouse left", part.Name)
        -- Thực hiện xử lý khi con trỏ chuột rời khỏi Part
    end)
end

-- Theo dõi sự kiện click chuột cho mỗi Part trong workspace
for _, part in pairs(workspace:GetDescendants()) do
    if part:IsA("Part") and part.Name == "Stone" then
        handleMouseEnter(part)
        handleMouseLeave(part)
    end
end
